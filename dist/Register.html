<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- <link href="https://stackpath.bootstrapcdn.com/bootstrap/5.0.0-beta1/css/bootstrap.min.css" rel="stylesheet"> -->
    <title>Register</title>
  </head>
  <body>
    <h2>Register page</h2>

    <form class="register">
      <h3>Register User</h3>
      <label for="email">Email:</label>
      <input type="text" name="email" id="emailInp" required />
      <label for="password">Password:</label>
      <input type="password" name="password" id="passwordInp" required />
      <label for="firstName">First Name:</label>
      <input type="text" name="firstName" id="fnameInput" />
      <label for="lastName">Last Name:</label>
      <input type="text" name="lastName" id="lnameInput" />

      <button type="submit" class="btn btn-primary">Create New user</button>
      <a href="../dist/Login.html">
        <button type="button" class="btn btn-primary">Sign in</button>
      </a>
    </form>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="./bundle.js"></script>
    <!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js"></script> -->
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-app.js";
      import {
        getAuth,
        createUserWithEmailAndPassword,
      } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-auth.js";
      import {
        getDatabase,
        ref,
        set,
      } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-database.js";

      const firebaseConfig = {
        apiKey: "AIzaSyBmno2mvP8YTKKlBdcBb6pPn3l5cb8pKJA",
        authDomain: "splash-wash-f27d8.firebaseapp.com",
        projectId: "splash-wash-f27d8",
        storageBucket: "splash-wash-f27d8.appspot.com",
        messagingSenderId: "1072800525434",
        appId: "1:1072800525434:web:7b423933d321c7e963dfc3",
      };

      const app = initializeApp(firebaseConfig);
      const db = getDatabase(app);
      const auth = getAuth(app);

      let EmailInp = $("#emailInp");
      let PassInp = $("#passwordInp");
      let FnameInp = $("#fnameInput");
      let LnameInp = $("#lnameInput");
      let MainForm = $(".register");

      let registerUser = (event) => {
        event.preventDefault();

        createUserWithEmailAndPassword(auth, EmailInp.val(), PassInp.val())
          .then((credential) => {
            // Saves data to the database
            set(ref(db, "usersAuthList/" + credential.user.uid), {
              email: EmailInp.val(),
              firstName: FnameInp.val(),
              lastName: LnameInp.val(),
            });
          })
          .catch((error) => {
            alert(error.message);
            console.log(error.message);
            console.log(error.code)
          });
      };

      console.log(registerUser);
      MainForm.on("submit", registerUser);
    </script>
  </body>
</html>